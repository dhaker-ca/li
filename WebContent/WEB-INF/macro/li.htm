<#-- 自定义标签 li 20121213 -->

<#--
    包裹一个操作按钮,有相应权限才会显示
-->
<#macro op pm="">
    <#if ""==pm || sa || user_permissions?seq_contains(pm)>
        <#nested>
    </#if>
</#macro>

<#--
    主界面左侧的功能菜单项
-->
<#macro menu text url icon="" pm="">
    <@li.op pm="${pm}">
		<li>
				<a href="${url}" class="list">					
					<#if ''!=icon><i class="${icon}"></i></#if>${text}
				</a>
			</li>
    </@li.op>
</#macro>

<#--
    control div
-->
<#macro control name="" label="">
    <div id="${name}" class="control-group">
        <label class="control-label" for="${name}">${label}</label>
        <div class="controls">
            <#nested><#---->
        </div>
    </div>
</#macro>

<#--
    input
-->
<#macro input name="" type="text" label="" value="" class="input-xlarge" maxlength="" readonly="" disabled="" placeholder="" onclick="">
    <@li.control name="${name}" label="${label}">
        <input type="${type}" class="${class}" id="${name}" name="${name}" maxlength="${maxlength}"
               <#if readonly!="">readonly</#if>
               <#if disabled!="">disabled</#if>
               <#if value!="">value="${value}"</#if>
               <#if onclick!="">onclick="${onclick}"</#if>
               <#if placeholder!="">placeholder="${placeholder}"</#if>
                />
    </@li.control>
</#macro>

<#--
    select
-->
<#macro select list key val name="" label="" value="" def="" disabled="" class="input-xlarge">
    <@li.control name="${name}" label="${label}">
        <select id="${name}" name="${name}" class="${class}" <#if disabled!="">disabled</#if>>
            <#if def!="">
                <option value="">${def}</option>
            </#if>
            <#list list as each>
                <option value="${each[key]}" <#if each[key]?string==value?string>selected</#if>>${each[val]}</option>
            </#list>
        </select>
    </@li.control>
</#macro>

<#--
    textarea
-->
<#macro textarea name="" type="text" label="" value="" class="input-xlarge" cols="500" rows="10"readonly="" placeholder="">
    <@li.control name="${name}" label="${label}">
        <textarea cols="${cols}" rows="${rows}" class="${class}" id="${name}" name="${name}"
                  <#if readonly!="">readonly</#if>
                  <#if placeholder!="">placeholder="${placeholder}"</#if>
                >${value}</textarea>
    </@li.control>
</#macro>

<#--
    从list中查找指定的值
-->
<#macro find list key val value>
    <#list list as each>
        <#if each[key]?string==value?string>${each[val]}</#if>
    </#list>
</#macro>

<#--
    以指定长度截取文本
-->
<#macro text value="" pre="" length="999">
    <#if (value??)&&(value?length gt length?number)>
        <span title="${pre} ${value!}">${value[0..length?number]}..</span>
    <#else>
        <span title="${pre} ${value!}">${value!}</span>
    </#if>
</#macro>

<#--
    定义一个table列表
-->
<#macro table list page action=""  cols=1>
    <table class="table table-striped">
        <#if list?size=0>
            <#assign i=-1/>
            <thead>
                <tr>
                    <#nested row,i,true/>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan=${cols}>
                        <b>没有符合条件的数据</b>
                    </td>
                </tr>
            </tbody>
        </#if>

        <#list list as row>
            <#if row_index==0>
                <#assign i=-1/>
                <thead>
                    <tr>
                        <#nested row,i,true/>
                    </tr>
                </thead>
            </#if>
            <#assign i=row_index has_next=row_has_next/>
            <#if row_index==0>
                <tbody>
                <tr>
            <#else>
                <tr>
            </#if>
            <#nested row,row_index,row_has_next/>
            <#if !row_has_next>
                </tr>
                </tbody>
            <#else>
                </tr>
            </#if>
        </#list>
    </table>
    
	<script type="text/javascript">
		$(".delete").click(function() {
			return doDelete($(this));
		});
	
		$(".window").click(function() {
			return doWindow($(this));
		});

		function reload() {
			$(".span9").load("${action}?page=${page.pageNumber}");
		}
	</script>
</#macro>

<#--
    定义table列表的一列
-->
<#macro tr title="">
    <#if i==-1>
        <th>${title}</th>
    <#else>
        <td><#nested/></td>
    </#if>
</#macro>

<#--
    定义一个弹出窗口包含一个form(表单)一个button(操作)
-->
<#macro window id="" title="window">
    <div class="modal hide fade in" id="${id}">
	    <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal">×</button>
	        <h3 id="h3Title">${title!}</h3>
	    </div>
        <#nested/><#-- 一个form 加 一个button-->
    </div>
</#macro>

<#--
    form表单,放在window里面的
-->
<#macro form id="" action="" method="POST">
    <div class="modal-body">
        <form class="form-horizontal" id="${id}" action="${action}" method="${method}">
            <fieldset>
                <#nested/><#-- 多个input-->
            </fieldset>
        </form>
    </div>

	<script type="text/javascript">
		$(".submit").click(function() {
			ajaxPost($("#${id}"));
		});
	</script>
</#macro>

<#--
    按钮组,放在window里面的
-->
<#macro button>
    <div class="modal-footer">
        <#nested/>
    </div>
</#macro>

<#--
	分页对象
-->
<#macro page pg url pn="page">
	<span class="btn-group page">
          <a class="btn <#if 2 gt pg.pageNumber>disabled</#if>" <#if 1 lt pg.pageNumber>href="${url}?${pn}=1"</#if>>首页</a>
          <a class="btn <#if 2 gt pg.pageNumber>disabled</#if>" <#if 1 lt pg.pageNumber>href="${url}?${pn}=${pg.previous}"</#if>>前一页</a>
          <a class="btn disabled">第${pg.pageNumber}页,共${pg.pageCount}页,共${pg.recordCount}行</a>
          <a class="btn <#if pg.pageCount-1 lt pg.pageNumber>disabled</#if>" <#if pg.pageCount gt pg.pageNumber>href="${url}?${pn}=${pg.next}"</#if>>后一页</a>
          <a class="btn <#if pg.pageCount-1 lt pg.pageNumber>disabled</#if>" <#if pg.pageCount gt pg.pageNumber>href="${url}?${pn}=${pg.pageCount}"</#if>>末页</a>
	</span>

	<script>
		$("span.page a").each(function(index, item) {
			$(this).click(function() {
				$(".span9").load($(this).attr("href"));
				return false;
			});
		});
	</script>
</#macro>